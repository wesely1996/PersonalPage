<div class="cookbook">
  <div class="panel">
    <div class="panel-header">
      <h1>Cookbook</h1>
      <app-search-input
        [placeholder]="'Search recipes by name, ingredients, or category...'"
        [value]="query"
        (valueChange)="applyFilter($event)"
      ></app-search-input>
    </div>

    <div class="table-wrapper" *ngIf="filtered.length; else emptyState">
      <table>
        <thead>
          <tr>
            <th
              class="sortable"
              (click)="toggleSort('title')"
              [attr.data-sort]="getSortIndicator('title')"
            >
              Title
              <img
                *ngIf="getSortIndicator('title') !== 'none'"
                src="icons/arrow.png"
                alt="^"
                class="folder-icon sort-arrow"
                [class.asc]="getSortIndicator('title') === 'asc'"
              />
            </th>
            <th
              class="category-col sortable"
              (click)="toggleSort('categories')"
              [attr.data-sort]="getSortIndicator('categories')"
            >
              Category
              <img
                *ngIf="getSortIndicator('categories') !== 'none'"
                src="icons/arrow.png"
                alt="^"
                class="folder-icon sort-arrow"
                [class.asc]="getSortIndicator('categories') === 'asc'"
              />
            </th>
            <th
              class="rating-col sortable"
              (click)="toggleSort('rating')"
              [attr.data-sort]="getSortIndicator('rating')"
            >
              Rating
              <img
                *ngIf="getSortIndicator('rating') !== 'none'"
                src="icons/arrow.png"
                alt="^"
                class="folder-icon sort-arrow"
                [class.asc]="getSortIndicator('rating') === 'asc'"
              />
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let recipe of filtered" (click)="openRecipe(recipe)">
            <td>{{ recipe.title }}</td>
            <td class="category-col">{{ recipe.categories?.join(", ") }}</td>
            <td class="rating-col">
              <div class="stars">
                <span
                  *ngFor="let filled of getStars(recipe.rating); let i = index"
                  [class.filled]="filled"
                >
                  &#9733;
                </span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #emptyState>
      <div class="empty">No recipes found.</div>
    </ng-template>
  </div>

  @if (selected) {
  <app-terminal-dialog
    [title]="selected?.title || 'Recipe'"
    [component]="'recipe'"
    [componentData]="selected"
    (closeDialogEvent)="closeDialog()"
  ></app-terminal-dialog>
  }
</div>
