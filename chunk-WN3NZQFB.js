import{m as V,p as Z,t as J,u as ee}from"./chunk-XQSHTZQE.js";import{$a as z,Bb as Q,C as A,Cb as K,Db as $,Fb as d,Ib as q,J as P,L as G,R as D,Ra as u,S as N,U as T,Wa as S,X as r,aa as b,ba as m,cb as v,g as f,m as j,p as B,pa as F,pb as y,q as E,sa as Y,tb as l,ub as s,vb as M,wa as X,x as R,xa as W,xb as U,y as C,yb as I,z as L}from"./chunk-RHHAP76N.js";var k;try{k=typeof Intl<"u"&&Intl.v8BreakIterator}catch{k=!1}var te=(()=>{class i{_platformId=m(X);isBrowser=this._platformId?Z(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||k)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(n){return new(n||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function _(i){return Array.isArray(i)?i:[i]}var ie=new Set,p,oe=(()=>{class i{_platform=m(te);_nonce=m(W,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):he}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&ce(t,this._nonce),this._matchMedia(t)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function ce(i,e){if(!ie.has(i))try{p||(p=document.createElement("style"),e&&p.setAttribute("nonce",e),p.setAttribute("type","text/css"),document.head.appendChild(p)),p.sheet&&(p.sheet.insertRule(`@media ${i} {body{ }}`,0),ie.add(i))}catch(t){console.error(t)}}function he(i){return{matches:i==="all"||i==="",media:i,addListener:()=>{},removeListener:()=>{}}}var O=(()=>{class i{_mediaMatcher=m(oe);_zone=m(F);_queries=new Map;_destroySubject=new B;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return ne(_(t)).some(o=>this._registerQuery(o).mql.matches)}observe(t){let o=ne(_(t)).map(c=>this._registerQuery(c).observable),a=L(o);return a=A(a.pipe(G(1)),a.pipe(D(1),P(0))),a.pipe(C(c=>{let h={matches:!1,breakpoints:{}};return c.forEach(({matches:g,query:ae})=>{h.matches=h.matches||g,h.breakpoints[ae]=g}),h}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);let n=this._mediaMatcher.matchMedia(t),a={observable:new j(c=>{let h=g=>this._zone.run(()=>c.next(g));return n.addListener(h),()=>{n.removeListener(h)}}).pipe(N(n),C(({matches:c})=>({query:t,matches:c})),T(this._destroySubject)),mql:n};return this._queries.set(t,a),a}static \u0275fac=function(n){return new(n||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function ne(i){return i.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}var re={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var w=class i{constructor(e){this.breakpointObserver=e;this.breakpointObserver.observe([re.Handset]).subscribe(t=>{this.isMobileSubject.next(t.matches)})}isMobileSubject=new E(!1);isMobile$=this.isMobileSubject.asObservable();isMobile(){return this.isMobileSubject.value}static \u0275fac=function(t){return new(t||i)(b(O))};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};var pe="https://script.google.com/macros/s/AKfycbwytEpVjThOS6xtD9xBeorPwG-RgOk6xiRfUHWBwRnU-LRiH5WbErtBCZqZqvn36B6gnQ/exec",x=class i{constructor(e){this.http=e}fetchHighscore(){let e=this.buildUrlWithParams({action:"getHighscore"});return R(this.http.jsonp(e,"callback")).then(t=>this.toHighscoreResponse(t))}submitScore(e){return R(this.http.jsonp(this.buildUrlWithParams({action:"submitScore",name:e.name,score:e.score}),"callback")).then(t=>({newHighscore:t.newHighscore,best:this.toHighscoreResponse(t,e)}))}buildUrlWithParams(e){let t=new J({fromObject:e});return`${pe}?${t.toString()}`}toHighscoreResponse(e,t){if(!e.ok)throw new Error(e.error||"Highscore service error");let n=e.best;return{name:(n?.name??t?.name??"---").toString(),highscore:Number(n?.highscore??t?.score??0)}}static \u0275fac=function(t){return new(t||i)(b(ee))};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};var ue=["gameCanvas"];function ge(i,e){i&1&&(l(0,"span"),d(1,"Loading..."),s())}function fe(i,e){if(i&1&&(l(0,"span"),d(1),s()),i&2){let t=I(2);u(),q("",t.highScoreName," - ",t.highScore,"")}}function be(i,e){i&1&&(l(0,"h2"),d(1,"Click to play"),s())}function Se(i,e){if(i&1&&(l(0,"div",2)(1,"h1"),d(2,"HACKER RUN GAME"),s(),l(3,"p"),d(4," Current high score: "),v(5,ge,2,0,"span")(6,fe,2,2,"span"),s(),M(7,"br"),v(8,be,2,0,"h2"),s()),i&2){let t=I();u(5),y(t.isLoadingHighScore?5:6),u(3),y(t.isLoadingHighScore?-1:8)}}var se=class i{constructor(e,t,n){this.el=e;this.screenSizeService=t;this.highscoreService=n}canvasRef;ctx;animationFrameId=0;hackerY=0;velocityY=0;gravity=.6;jumping=!1;jumpCount=0;jumpPressed=!1;jumpHeight=0;maxJumpHeight=180;obstacleX=500;obstacleHeight=20;flyingObstacleX=800;flyingObstacleY=100;score=0;highScore=0;highScoreName="---";currentHighScore=0;isLoadingHighScore=!1;scoreInterval;gameRunning=!1;baseSpeed=1;jumpSpeed=7;speedModifier=1;screenSizeSub;dinoImg=new Image;groundLevel=210;baseColor="#00ff00";backgorundColor="rgba(0,0,0,0.6)";ngOnInit(){document.addEventListener("click",this.handleDocumentClick),this.dinoImg.src="images/dino-player.png",this.updateSpeedModifier(this.screenSizeService.isMobile()),this.screenSizeSub=this.screenSizeService.isMobile$.subscribe(e=>this.updateSpeedModifier(e)),this.loadHighScoreFromApi()}ngAfterViewInit(){this.ctx=this.canvasRef.nativeElement.getContext("2d"),this.clearGame()}resetGame(){this.hackerY=0,this.velocityY=0,this.jumping=!1,this.jumpHeight=0,this.jumpCount=0,this.obstacleX=500,this.obstacleHeight=20,this.flyingObstacleX=800,this.score=0,this.baseSpeed=1,clearInterval(this.scoreInterval)}startGame(){this.gameRunning=!0,this.score=0,this.baseSpeed=1,this.loop(),this.scoreInterval=setInterval(()=>this.score+=Math.max(1,this.effectiveSpeed),100)}stopGame(){if(!this.gameRunning){this.clearGame();return}this.clearGame(),this.handleGameOver()}clearGame(){this.gameRunning=!1,cancelAnimationFrame(this.animationFrameId),clearInterval(this.scoreInterval)}loop=()=>{this.gameRunning&&(this.update(),this.draw(),this.animationFrameId=requestAnimationFrame(this.loop))};update(){let e=this.effectiveSpeed;this.jumpPressed&&this.jumpHeight<this.maxJumpHeight&&this.jumpCount<2?(this.velocityY=-this.jumpSpeed*e,this.jumpHeight+=this.jumpSpeed*e):this.velocityY+=this.gravity*e,this.hackerY+=this.velocityY*e,this.hackerY=Math.min(this.hackerY,this.groundLevel-20),this.hackerY===this.groundLevel-20&&(this.jumpCount=0),this.hackerY=Math.max(this.hackerY,0),this.obstacleX-=5*e,this.obstacleX<-20&&(this.obstacleX=520+Math.random()*200,this.obstacleHeight=20+Math.random()*30),this.flyingObstacleX-=7*e,this.flyingObstacleX<-20&&(this.flyingObstacleX=520+Math.random()*300,this.flyingObstacleY=60+Math.random()*80);let t=this.hackerY+20,n=this.hackerY;this.obstacleX<40&&this.obstacleX>0&&t>this.groundLevel-20&&this.stopGame(),this.flyingObstacleX<40&&this.flyingObstacleX>0&&n<this.flyingObstacleY+20&&t>this.flyingObstacleY&&this.stopGame(),this.score%100<1&&(this.baseSpeed+=.01)}draw(){let e=this.ctx;e.clearRect(0,0,500,250),e.fillStyle=this.backgorundColor,e.fillRect(0,0,500,250),e.drawImage(this.dinoImg,20,this.hackerY,20,20),this.drawGroundObstacle(e),this.drawFlyingObstacle(e),e.fillRect(0,this.groundLevel,500,2),e.font="14px monospace",e.fillText(`Score: ${Math.floor(this.score)}`,10,20);let t=`${this.currentHighScore}`;e.fillText(`High: ${t}`,330,20)}drawGroundObstacle(e){e.fillStyle=this.baseColor,e.fillRect(this.obstacleX,this.groundLevel-this.obstacleHeight,20,this.obstacleHeight)}drawFlyingObstacle(e){e.fillStyle=this.baseColor,e.fillRect(this.flyingObstacleX,this.flyingObstacleY,20,20)}onMouseDown(){this.isLoadingHighScore||(this.gameRunning?(this.jumpPressed=!0,this.jumpCount===0&&(this.jumpHeight=0)):(this.resetGame(),this.startGame()))}onMouseUp(){this.jumpPressed=!1,this.jumpCount++}handleDocumentClick=e=>{this.el.nativeElement.contains(e.target)||this.stopGame()};handleGameOver(){return f(this,null,function*(){let e=Math.floor(this.score);if(!(e<=0)&&(e>this.currentHighScore&&(this.currentHighScore=e),e>this.highScore)){let t=prompt("New High Score! Enter your name to submit:",this.highScoreName)?.trim()||"";t&&(yield this.submitHighScore({name:t,score:e}))}})}submitHighScore(e){return f(this,null,function*(){try{let t=yield this.highscoreService.submitScore(e);this.updateHighScoreState(t.best)}catch(t){console.error("Failed to submit high score",t)}})}loadHighScoreFromApi(){return f(this,null,function*(){this.isLoadingHighScore=!0;try{let e=yield this.highscoreService.fetchHighscore();this.updateHighScoreState(e)}catch(e){console.error("Failed to load high score",e),this.loadHighScoreFromLocal()}finally{this.isLoadingHighScore=!1}})}loadHighScoreFromLocal(){let e=localStorage.getItem("dinoHighScore"),t=localStorage.getItem("dinoHighScoreName");e&&this.updateHighScoreState({name:t??this.highScoreName,highscore:+e})}updateHighScoreState(e){this.highScore=e.highscore,this.highScoreName=e.name,this.persistHighScoreLocally()}persistHighScoreLocally(){localStorage.setItem("dinoHighScore",this.highScore.toString()),localStorage.setItem("dinoHighScoreName",this.highScoreName)}ngOnDestroy(){this.stopGame(),this.screenSizeSub?.unsubscribe(),document.removeEventListener("click",this.handleDocumentClick)}get effectiveSpeed(){return this.baseSpeed*this.speedModifier}updateSpeedModifier(e){this.speedModifier=e?.75:1}static \u0275fac=function(t){return new(t||i)(S(Y),S(w),S(x))};static \u0275cmp=z({type:i,selectors:[["app-hacker-run-game"]],viewQuery:function(t,n){if(t&1&&Q(ue,7),t&2){let o;K(o=$())&&(n.canvasRef=o.first)}},hostBindings:function(t,n){t&1&&U("mousedown",function(){return n.onMouseDown()})("touchstart",function(){return n.onMouseDown()})("mouseup",function(){return n.onMouseUp()})("touchend",function(){return n.onMouseUp()})("touchcancel",function(){return n.onMouseUp()})},decls:4,vars:1,consts:[["gameCanvas",""],[1,"game-container"],[1,"game-title"],["width","500","height","250"]],template:function(t,n){t&1&&(l(0,"div",1),v(1,Se,9,2,"div",2),M(2,"canvas",3,0),s()),t&2&&(u(),y(n.gameRunning?-1:1))},dependencies:[V],styles:[".game-container[_ngcontent-%COMP%]{width:100%;max-width:500px;height:250px;border:2px solid rgb(0,255,0);border-radius:10px;background-color:#000000b3;overflow:hidden}.game-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block}.game-container[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0f0}.game-title[_ngcontent-%COMP%]{text-align:center;color:#0f0;font-family:Courier New,monospace;font-weight:700;text-shadow:0 0 3px rgb(0,255,0)}@media (max-width: 600px){.game-container[_ngcontent-%COMP%]{height:200px}h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{font-size:1rem}br[_ngcontent-%COMP%]{display:none}}"]})};export{se as HackerRunGameComponent};
