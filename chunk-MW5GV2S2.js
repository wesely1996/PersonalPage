import{a as E,b as T}from"./chunk-5OX7ZBJI.js";import"./chunk-RGXSXGDA.js";import{a as F}from"./chunk-MLCEQPVL.js";import"./chunk-L2MR3JKQ.js";import{a as V}from"./chunk-VP5QEZ2X.js";import{a as R}from"./chunk-SZJ6MPGP.js";import"./chunk-RTA3XN6B.js";import{k as S,l as D,m as I}from"./chunk-XQSHTZQE.js";import{$a as v,Eb as P,Fb as g,Gb as y,Kb as w,Ra as a,Wa as M,cb as m,ha as _,ia as h,lb as b,mb as p,ob as f,pb as O,tb as c,ub as r,vb as x,wb as u,xb as C,yb as s}from"./chunk-RHHAP76N.js";function K(o,e){if(o&1&&x(0,"img",13),o&2){let t=s(2);f("asc",t.getSortIndicator("title")==="asc")}}function $(o,e){if(o&1&&x(0,"img",13),o&2){let t=s(2);f("asc",t.getSortIndicator("categories")==="asc")}}function j(o,e){if(o&1&&x(0,"img",13),o&2){let t=s(2);f("asc",t.getSortIndicator("rating")==="asc")}}function q(o,e){if(o&1&&(c(0,"span"),g(1," \u2605 "),r()),o&2){let t=e.$implicit;f("filled",t)}}function A(o,e){if(o&1){let t=u();c(0,"tr",14),C("click",function(){let i=_(t).$implicit,l=s(2);return h(l.openRecipe(i))}),c(1,"td"),g(2),r(),c(3,"td",15),g(4),r(),c(5,"td",16)(6,"div",17),m(7,q,2,2,"span",18),r()()()}if(o&2){let t=e.$implicit,n=s(2);a(2),y(t.title),a(2),y(t.categories==null?null:t.categories.join(", ")),a(3),p("ngForOf",n.getStars(t.rating))}}function G(o,e){if(o&1){let t=u();c(0,"div",7)(1,"table")(2,"thead")(3,"tr")(4,"th",8),C("click",function(){_(t);let i=s();return h(i.toggleSort("title"))}),g(5," Title "),m(6,K,1,2,"img",9),r(),c(7,"th",10),C("click",function(){_(t);let i=s();return h(i.toggleSort("categories"))}),g(8," Category "),m(9,$,1,2,"img",9),r(),c(10,"th",11),C("click",function(){_(t);let i=s();return h(i.toggleSort("rating"))}),g(11," Rating "),m(12,j,1,2,"img",9),r()()(),c(13,"tbody"),m(14,A,8,3,"tr",12),r()()()}if(o&2){let t=s();a(4),b("data-sort",t.getSortIndicator("title")),a(2),p("ngIf",t.getSortIndicator("title")!=="none"),a(),b("data-sort",t.getSortIndicator("categories")),a(2),p("ngIf",t.getSortIndicator("categories")!=="none"),a(),b("data-sort",t.getSortIndicator("rating")),a(2),p("ngIf",t.getSortIndicator("rating")!=="none"),a(2),p("ngForOf",t.filtered)}}function L(o,e){o&1&&(c(0,"div",19),g(1,"No recipes found."),r())}function z(o,e){if(o&1){let t=u();c(0,"app-terminal-dialog",20),C("closeDialogEvent",function(){_(t);let i=s();return h(i.closeDialog())}),r()}if(o&2){let t=s();p("title",(t.selected==null?null:t.selected.title)||"Recipe")("component","recipe")("componentData",t.selected)}}var N=class o{constructor(e){this.sheets=e}recipes=[];filtered=[];selected=null;query="";sortKey=null;sortDirection=null;ngOnInit(){let e=R.cookbookCsvUrl;e&&this.sheets.fetchBooksFromSheet(e).then(t=>{this.recipes=Array.isArray(t)?t.map(n=>this.toRecipe(n)).filter(n=>!!n.title).sort((n,i)=>n.title.localeCompare(i.title)):[],this.applyFilter()}).catch(()=>{this.recipes=[],this.filtered=[]})}applyFilter(e){typeof e=="string"&&(this.query=e);let t=(this.query??"").trim().toLowerCase();if(!t){this.filtered=[...this.recipes],this.applySort();return}let n=Number(t);if(!Number.isNaN(n)&&n>=1&&n<=5&&/^\d$/.test(t)){let l=Math.round(n);this.filtered=this.recipes.filter(d=>Math.round(d.rating)===l),this.applySort();return}this.filtered=this.recipes.filter(l=>{let d=l.categories?.join(", ")??"";return`${l.title} ${l.ingredients??""} ${l.instructions??""} ${d}`.toLowerCase().includes(t)}),this.applySort()}getStars(e){let t=Math.max(0,Math.min(5,Math.round(e)));return Array.from({length:5},(n,i)=>i<t)}openRecipe(e){this.selected=e}closeDialog(){this.selected=null}toggleSort(e){if(this.sortKey!==e){this.sortKey=e,this.sortDirection="desc",this.applyFilter();return}if(this.sortDirection==="desc"){this.sortDirection="asc",this.applyFilter();return}if(this.sortDirection==="asc"){this.sortKey=null,this.sortDirection=null,this.applyFilter();return}this.sortDirection="desc",this.applyFilter()}getSortIndicator(e){return this.sortKey!==e||!this.sortDirection?"none":this.sortDirection}toRecipe(e){let t=e?.title??"",n=e?.ingredients??"",i=e?.instructions??"",l=E(e?.categories),d=e?.rating??0,k=Number.isNaN(Number(d))?0:Math.max(0,Math.min(5,Number(d)));return{id:e?.id??e?.ID??"",title:t,ingredients:n,instructions:i,categories:l,rating:k}}applySort(){if(!this.sortKey||!this.sortDirection)return;let e=this.sortDirection==="asc"?1:-1;this.filtered=[...this.filtered].sort((t,n)=>{if(this.sortKey==="rating")return(t.rating-n.rating)*e;let i=this.sortKey==="title"?t.title:(t.categories??[]).join(", "),l=this.sortKey==="title"?n.title:(n.categories??[]).join(", ");return i.localeCompare(l)*e})}static \u0275fac=function(t){return new(t||o)(M(V))};static \u0275cmp=v({type:o,selectors:[["app-cookbook"]],decls:10,vars:5,consts:[["emptyState",""],[1,"cookbook"],[1,"panel"],[1,"panel-header"],[3,"valueChange","placeholder","value"],["class","table-wrapper",4,"ngIf","ngIfElse"],[3,"title","component","componentData"],[1,"table-wrapper"],[1,"sortable",3,"click"],["src","icons/arrow.png","alt","^","class","folder-icon sort-arrow",3,"asc",4,"ngIf"],[1,"category-col","sortable",3,"click"],[1,"rating-col","sortable",3,"click"],[3,"click",4,"ngFor","ngForOf"],["src","icons/arrow.png","alt","^",1,"folder-icon","sort-arrow"],[3,"click"],[1,"category-col"],[1,"rating-col"],[1,"stars"],[3,"filled",4,"ngFor","ngForOf"],[1,"empty"],[3,"closeDialogEvent","title","component","componentData"]],template:function(t,n){if(t&1){let i=u();c(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1"),g(4,"Cookbook"),r(),c(5,"app-search-input",4),C("valueChange",function(d){return _(i),h(n.applyFilter(d))}),r()(),m(6,G,15,7,"div",5)(7,L,2,0,"ng-template",null,0,w),r(),m(9,z,1,3,"app-terminal-dialog",6),r()}if(t&2){let i=P(8);a(5),p("placeholder","Search recipes by name, ingredients, or category...")("value",n.query),a(),p("ngIf",n.filtered.length)("ngIfElse",i),a(3),O(n.selected?9:-1)}},dependencies:[I,S,D,F,T],styles:[".cookbook[_ngcontent-%COMP%]{height:80vh;display:flex;align-items:flex-start;justify-content:center;padding-top:8vh;color:#0f0;font-family:Courier New,monospace}.panel[_ngcontent-%COMP%]{width:80vw;max-width:1200px;height:100%;background:#000c;border:1px solid rgb(0,255,0);border-radius:10px;box-shadow:0 0 18px #00ff0040;padding:1.25rem}.panel-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.75rem;margin-bottom:1rem}.panel-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2rem;text-align:center;letter-spacing:.04em}.table-wrapper[_ngcontent-%COMP%]{max-height:85%;border:1px solid rgb(0,255,0);border-radius:8px;background:#000000e6}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;table-layout:fixed}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.9rem .8rem;border-bottom:1px solid rgba(0,0,0,.7);text-align:left;word-break:break-word}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:1.25rem;letter-spacing:.03em;border-bottom:1px solid rgb(0,255,0)}table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}table[_ngcontent-%COMP%]   th.sortable[_ngcontent-%COMP%]:hover{background:#000000b3}table[_ngcontent-%COMP%]   .sort-arrow[_ngcontent-%COMP%]{display:inline-block;width:1rem;height:1rem;margin-left:.35rem;filter:drop-shadow(0 0 3px rgb(0,255,0))}table[_ngcontent-%COMP%]   .sort-arrow.asc[_ngcontent-%COMP%]{transform:rotate(180deg)}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.7)}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background .2s ease,transform .2s ease}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#000000b3;box-shadow:0 0 12px #0f0c;cursor:pointer;font-weight:700}tbody[_ngcontent-%COMP%]{display:block;max-height:60vh;overflow-y:auto;overflow-x:hidden;width:100%;scrollbar-width:none;-ms-overflow-style:none}tbody[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}thead[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:table;width:100%;table-layout:fixed}.rating-col[_ngcontent-%COMP%], td.rating-col[_ngcontent-%COMP%]{width:140px}.category-col[_ngcontent-%COMP%], td.category-col[_ngcontent-%COMP%]{width:240px}.stars[_ngcontent-%COMP%]{display:inline-flex;gap:4px}.stars[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#000000b3;text-shadow:none;transition:color .15s ease}.stars[_ngcontent-%COMP%]   span.filled[_ngcontent-%COMP%]{color:#0f0;text-shadow:0 0 6px rgba(0,255,0,.4)}.empty[_ngcontent-%COMP%]{text-align:center;padding:2rem 0;opacity:.7}@media (max-width: 900px){.panel[_ngcontent-%COMP%]{width:92vw;padding:1rem}.table-wrapper[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]{max-height:none}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.7rem}}"]})};export{N as CookbookComponent};
